function zoomstart(){}function zoom(){isChoiceNode?($("#ttt01").text(d3.event.translate),$("#ttt02").text(d3.event.scale),zoomer.translate([d3.event.translate[0]-(choiceNode2.x-node_start_x)*d3.event.scale,d3.event.translate[1]-(choiceNode2.y-node_start_y)*d3.event.scale]),zoomer.scale(d3.event.scale),zoom_xy=[d3.event.translate[0]-(choiceNode2.x-node_start_x)*d3.event.scale,d3.event.translate[1]-(choiceNode2.y-node_start_y)*d3.event.scale]):($("#ttt01").text(d3.event.translate),$("#ttt02").text(d3.event.scale),translate=d3.event.translate,scale=d3.event.scale,vis.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")"),zoom_xy=d3.event.translate),zoom_num=d3.event.scale}function keydown(){var a,b;if(shiftKey=d3.event.shiftKey||d3.event.metaKey,ctrlKey=d3.event.ctrlKey,$("#ttt04").text(shiftKey),67==d3.event.keyCode)center_view();else if(46==d3.event.keyCode)for(a=svg.selectAll(".nodetext")[0],b=0;b<a.length;b++)a[b].__data__.hasOwnProperty("ys")||1!=a[b].__data__.selected?a[b].__data__.hasOwnProperty("ys")&&""==a[b].__data__.ys&&1==a[b].__data__.selected&&delNode(a[b].__data__.id):delNode(a[b].__data__.id);shiftKey&&($(".brush").show(),svg_graph.call(zoomer).on("mousedown.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom",null),vis.selectAll("g.gnode").on("mousedown.drag",null),brush.select(".background").style("cursor","crosshair"),brush.call(brusher))}function keyup(){shiftKey=d3.event.shiftKey||d3.event.metaKey,ctrlKey=d3.event.ctrlKey,$("#ttt04").text(shiftKey),brush.call(brusher).on("mousedown.brush",null).on("touchstart.brush",null).on("touchmove.brush",null).on("touchend.brush",null),brush.select(".background").style("cursor","auto"),svg_graph.call(zoomer)}function mouseup(){$(".brush").hide()}function firstLoad(a,b){var c=layer.load();d3.json(appRoot+"/gxfx/getRootNode.xhtml?id="+encodeURIComponent(a)+"&level="+b,function(b,d){var e,f;layer.close(c),clearAll(),isIE=$.browser.msie,nodeGraph=d,b||(force=d3.layout.force().nodes(d.nodes).links(d.edges).size([width,height]).linkDistance(link_d).charge(charge).start(),nodes=force.nodes(),edges=force.links(),node=vis.selectAll("image"),edges_line=vis.selectAll("line").data(d.edges).enter().append("line").attr("class",function(a){return getLineType(a)}).style("stroke",function(a){return getLineColor(a)}).style("stroke-width",function(a){return getLineWeight(a)}),edges_text=vis.selectAll(".linetext").data(d.edges).enter().append("text").attr("class","linetext").text(function(a){return a.relation}).on("mousedown",function(a){toDetail(a),event.stopPropagation()}),drag=force.drag().on("dragstart",function(a){a.fixed=!0,node_start_x=a.x,node_start_y=a.y}).on("dragend",function(){}).on("drag",function(){}),pathRoot=vis.append("path").attr("class","pathRoot").attr("fill","none").attr("stroke","#EE6911").attr("stroke-width","1").attr("lx","initHightLight").attr("id","bs_"+a),nodes_img=vis.selectAll("image").data(d.nodes).enter().append("image").attr("id",function(a){return a.id.substr(2)}).attr("width",img_w).attr("height",img_h).attr("xlink:href",function(a){return getNodeImage(a)}).on("mouseover",function(a){isOverNode=!0,3==relation_show&&edges_text.style("fill-opacity",function(b){return b.source===a||b.target===a?1:void 0})}).on("mouseout",function(a){isOverNode=!1,3==relation_show&&edges_text.style("fill-opacity",function(b){return b.source===a||b.target===a?0:void 0})}).on("mousedown",function(a,b){isChoiceNode=!0,choiceNode=this,choiceNode2=a,choiceNodeIndex=b}).on("dblclick",function(a){a.fixed=!1}).call(drag),e=-20,f=20,nodes_text=vis.selectAll(".nodetext").data(d.nodes).enter().append("text").attr("class","nodetext").attr("dx",e).attr("dy",f).text(function(a){return a.name}),force.on("start",function(){}),force.on("end",function(){}),force.on("tick",function(){d.nodes.forEach(function(a){a.x=a.x-img_w/2<0?img_w/2:a.x,a.x=a.x+img_w/2>width?width-img_w/2:a.x,a.y=a.y-img_h/2<0?img_h/2:a.y,a.y=a.y+img_h/2+f>height?height-img_h/2-f:a.y}),edges_line.attr("x1",function(a){return a.source.x}),edges_line.attr("y1",function(a){return a.source.y}),edges_line.each(function(a){var b,c,d,e,f,g;isIE&&this.parentNode.insertBefore(this,this),b=a.source.x,c=a.source.y,x2=a.target.x,y2=a.target.y,d=Math.sqrt(Math.pow(x2-b,2)+Math.pow(y2-c,2)),e=20,f=b+(d-e)/d*(x2-b),g=c+(d-e)/d*(y2-c),d3.select(this).attr("x2",f).attr("y2",g)}),edges_text.attr("x",function(a){return(a.source.x+a.target.x)/2}),edges_text.attr("y",function(a){return(a.source.y+a.target.y)/2}),nodes_img.attr("x",function(a){return a.x-img_w/2}),nodes_img.attr("y",function(a){return a.y-img_h/2}),nodes_text.attr("x",function(a){return a.x}),nodes_text.attr("y",function(a){return a.y+img_w/2}),d.nodes.forEach(function(b){var d,e,f,g,j,k,n;b.id==a&&(rootName=b.name,rootId=b.id,rootLx=b.lx,d=b.x-img_w/2,e=b.y-img_h/2,f=d,g=e,j=d+img_w,k=e+img_h,n="M"+f+" "+g+" "+"A 20 20 0 1 0 "+j+" "+k+"A 20 20 0 1 0 "+f+" "+g,pathRoot.attr("d",n))})}),center_view())})}function center_view(){var a=-2500+$(window).width()/2,b=-2500+$(window).height()/2-10;vis.attr("transform","translate("+a+","+b+")scale(1.0)"),zoomer.translate([a,b]),zoomer.scale(1),translate=[a,b],scale=1}function getAllChildNode(a){data01.push(a)}function deleteNode(a){var b,c,d,e;for(getAllChildNode(a),delNum+=data01.length,b=d3.selectAll("image")[0],c=0;c<b.length;c++)for(d=b[c],e=0;e<data01.length;e++)d.hasOwnProperty("__data__")&&d.__data__.id==data01[e].id&&(d3.select(d).remove(),d3.select("#bs_"+d.__data__.id).remove(),null!=pathRoot&&d.__data__.id==pathRoot.attr("id").substr(3)&&d3.select(".pathRoot").remove());for(c=0;c<nodes.length;c++)for(d=nodes[c],e=0;e<data01.length;e++)d.id==data01[e].id&&(nodes.splice(c,1),--c)}function deleteLine(){var b,c,d,a=d3.selectAll("line")[0];for(b=0;b<a.length;b++)for(c=a[b],d=0;d<data01.length;d++)(c.__data__.source.id==data01[d].id||c.__data__.target.id==data01[d].id)&&d3.select(c).remove();for(b=0;b<edges.length;b++)for(c=edges[b],d=0;d<data01.length;d++)(c.source.id==data01[d].id||c.target.id==data01[d].id)&&(edges.splice(b,1),--b)}function deleteNodeName(){var b,c,d,a=svg.selectAll(".nodetext")[0];for(b=0;b<a.length;b++)for(c=a[b],d=0;d<data01.length;d++)c.hasOwnProperty("__data__")&&c.__data__.id==data01[d].id&&d3.select(c).remove()}function clearAll(){var b,c,d,e,f,a=d3.selectAll("image")[0];for(b=0;b<a.length;b++)d3.select(a[b]).remove();for(c=svg.selectAll(".nodetext")[0],b=0;b<c.length;b++)d3.select(c[b]).remove();for(d=d3.selectAll("line")[0],b=0;b<d.length;b++)d3.select(d[b]).remove();for(e=d3.selectAll(".linetext")[0],b=0;b<e.length;b++)d3.select(e[b]).remove();for(f=d3.selectAll(".pathRoot")[0],b=0;b<f.length;b++);}function deleteLineText(){var b,c,d,a=d3.selectAll(".linetext")[0];for(b=0;b<a.length;b++)for(c=a[b],d=0;d<data01.length;d++)(c.__data__.source.id==data01[d].id||c.__data__.target.id==data01[d].id)&&d3.select(c).remove()}function startAndStop(a){var b,c;if(a){for(b=d3.selectAll("image")[0],c=0;c<b.length;c++)b[c].hasOwnProperty("__data__")&&(b[c].__data__.fixed=!1);force.start()}else force.stop()}function expandRelationship(a){var b=layer.load();d3.json(a,function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(layer.close(b),clearAll(),d=1,e=2*Math.PI*d,f=e/c.nodes.length,g=f/d,h=0,i=0,j=nodes.length,k=0,l=0;l<c.nodes.length;l++){for(0==l?(h=choiceNode2.x+1,i=choiceNode2.y):(m=g-Math.asin((h-choiceNode2.x)/d),h=Math.sin(m)+choiceNode2.x,i=Math.cos(m)+choiceNode2.y),c.nodes[l].x=h,c.nodes[l].y=i,c.nodes[l].px=h,c.nodes[l].py=i,n=-1,o=0;o<nodes.length;o++)c.nodes[l].id==nodes[o].id&&(n=o,k++);if(-1!=n)for(o=0;o<c.edges.length;o++)c.edges[o].toID==nodes[n].id&&(c.edges[o].target=n),c.edges[o].target>j+l-k&&c.edges[o].target--;else c.nodes[l].index-=k,nodes.push(c.nodes[l])}for(l=0;l<c.edges.length;l++){for(o=0;o<edges.length;o++)c.edges[l].fromID==edges[o].toID&&c.edges[l].toID==edges[o].fromID&&(edges[o].relation+=","+c.edges[l].relation,c.edges[l].relation="");edges.push(c.edges[l])}a||(edges_line=vis.selectAll("line").data(edges).enter().append("line").attr("class",function(a){return getLineType(a)}).style("stroke",function(a){return getLineColor(a)}).style("stroke-width",function(a){return getLineWeight(a)}),edges_text=vis.selectAll(".linetext").data(edges).enter().append("text").attr("class","linetext").style("fill-opacity",1==relation_show?1:0).text(function(a){return a.relation}).on("mousedown",function(a){toDetail(a),event.stopPropagation()}),nodes_img=vis.selectAll("image").data(nodes).enter().append("image").attr("class","imagenode").attr("id",function(a){return a.id.substr(2)}).attr("width",function(a){return("undefined"!=node.icon&&a.icon.indexOf("YS_YS_"))>-1?40:img_w}).attr("height",function(a){return("undefined"!=node.icon&&a.icon.indexOf("YS_YS_"))>-1?40:img_h}).attr("xlink:href",function(a){return getNodeImage(a)}).on("mouseover",function(a){isOverNode=!0,3==relation_show&&edges_text.style("fill-opacity",function(b){return b.source===a||b.target===a?1:void 0})}).on("mouseout",function(a){isOverNode=!1,3==relation_show&&edges_text.style("fill-opacity",function(b){return b.source===a||b.target===a?0:void 0})}).on("mousedown",function(a,b){isChoiceNode=!0,choiceNode=this,choiceNode2=a,choiceNodeIndex=b}).on("dblclick",function(a){a.fixed=!1}).call(drag),p=-20,q=20,nodes_text=vis.selectAll(".nodetext").data(nodes).enter().append("text").attr("class","nodetext").attr("dx",p).attr("dy",q).text(function(a){return a.name}),force.friction(.5),force.on("start",function(){}),force.on("end",function(){}),force.on("tick",function(){nodes.forEach(function(a){a.x=a.x-img_w/2<0?img_w/2:a.x,a.x=a.x+img_w/2>width?width-img_w/2:a.x,a.y=a.y-img_h/2<0?img_h/2:a.y,a.y=a.y+img_h/2+q>height?height-img_h/2-q:a.y}),edges_line.attr("x1",function(a){return a.source.x}),edges_line.attr("y1",function(a){return a.source.y}),edges_line.each(function(a){var b,c,d,e,f,g;isIE&&null!=this.parentNode&&this.parentNode.insertBefore(this,this),b=a.source.x,c=a.source.y,x2=a.target.x,y2=a.target.y,d=Math.sqrt(Math.pow(x2-b,2)+Math.pow(y2-c,2)),e=20,f=b+(d-e)/d*(x2-b),g=c+(d-e)/d*(y2-c),d3.select(this).attr("x2",f).attr("y2",g)}),edges_text.attr("x",function(a){return(a.source.x+a.target.x)/2}),edges_text.attr("y",function(a){return(a.source.y+a.target.y)/2}),nodes_img.attr("x",function(a){return a.x-img_w/2}),nodes_img.attr("y",function(a){return a.y-img_h/2}),nodes_text.attr("x",function(a){return a.x}),nodes_text.attr("y",function(a){return a.y+img_w/2}),nodes.forEach(function(a,b){var d,e,f,g,h,i,j,k,l,m,n,c=d3.selectAll(".pathRoot")[0];for(b=0;b<c.length;b++)if(a.id==c[b].id.substr(3)){d=a.x-img_w/2,e=a.y-img_h/2,f=d,g=e,h=d+img_w,i=e,j=d+img_w,k=e+img_h,l=d,m=e+img_h,n="M"+f+" "+g+" "+"L"+h+" "+i+" "+"L"+j+" "+k+" "+"L"+l+" "+m+" Z","initHightLight"==d3.select(c[b]).attr("lx")&&(n="M"+f+" "+g+" "+"A 20 20 0 1 0 "+j+" "+k+"A 20 20 0 1 0 "+f+" "+g),d3.select(c[b]).attr("d",n);break}})}),force.stop(),force.start(),delNum=0)})}function showShaixuan(a){a?($(".shaixuan_tools_bg").show(1e3),$(".shaixuan_tools").show(1e3)):($(".shaixuan_tools_bg").hide(1e3),$(".shaixuan_tools").hide(1e3))}function testTool(){$(".tools").show(1e3)}function showRelation(a){var c,b=d3.selectAll(".linetext")[0];if(1==a)for($("#xsgx_font").text("显示关系"),relation_show=1,c=0;c<b.length;c++)d3.select(b[c]).style("fill-opacity",1);else if(2==a)for($("#xsgx_font").text("隐藏关系"),relation_show=2,c=0;c<b.length;c++)d3.select(b[c]).style("fill-opacity",0);else if(3==a)for($("#xsgx_font").text("悬浮关系"),relation_show=3,c=0;c<b.length;c++)d3.select(b[c]).style("fill-opacity",0)}function jdgxChange(a){1==a?$("#jdgxcx_font").text("节点"):$("#jdgxcx_font").text("关系")}function jdgxSearch(){var a,b,c,d,e,f,g,h,i,j,k,l;if("节点"==$("#jdgxcx_font").text()){for(a=svg.selectAll(".nodetext")[0],b=!1,c=new Array,d=new Array,e=0;e<a.length;e++)f=a[e],f.hasOwnProperty("__data__")&&f.__data__.hasOwnProperty("name")&&(-1!=f.__data__.name.indexOf($("#jdgxcx_text").val())&&""!=$("#jdgxcx_text").val()?(d3.select(f).style("display","block"),d3.select(f).classed({selected:!0}),b=!0,d.push(f.__data__.name)):(d3.select(f).style("display","none"),d3.select(f).classed({selected:!1})));if(b){for(i=0;i<d.length;i++)for(j=0;j<nodes.length;j++)nodes[j].name==d[i]&&c.indexOf(nodes[j].id)<0&&c.push(nodes[j].id);highLightNode(c.join())}else{for(e=0;e<a.length;e++)f=a[e],f.hasOwnProperty("__data__")&&f.__data__.hasOwnProperty("name")&&d3.select(f).style("display","block");for(g=d3.selectAll(".pathRoot")[0],h=0;h<g.length;h++)"initHightLight"!=d3.select(g[h]).attr("lx")&&d3.select(g[h]).remove()}}else{for(k=d3.selectAll("line")[0],e=0;e<k.length;e++)f=k[e],f.hasOwnProperty("__data__")&&f.__data__.hasOwnProperty("relation")&&(-1!=f.__data__.relation.indexOf($("#jdgxcx_text").val())&&""!=$("#jdgxcx_text").val()?(isIE?d3.select(f).style("marker-end","none"):d3.select(f).style("marker-end","url(#arrow)"),d3.select(f).style("stroke","red")):(d3.select(f).style("marker-end","url(#arrow)"),d3.select(f).style("stroke","")));for(l=d3.selectAll(".linetext")[0],e=0;e<l.length;e++)f=l[e],f.hasOwnProperty("__data__")&&f.__data__.hasOwnProperty("relation")&&(-1!=f.__data__.relation.indexOf($("#jdgxcx_text").val())&&""!=$("#jdgxcx_text").val()?(d3.select(f).style("fill","red"),d3.select(f).style("fill-opacity",1)):d3.select(f).style("fill","#0000FF"))}}function showName(a){var c,d,b=svg.selectAll(".nodetext")[0];for(c=0;c<b.length;c++)d=b[c],a?($("#xsmc_font").text("显示名称"),d3.select(d).style("display","block")):($("#xsmc_font").text("隐藏名称"),d3.select(d).style("display","none"))}function getLineType(a){var b="link";return"undefined"!=typeof a.type&&"hz"==a.type&&(b="Hzlink"),b}function getLineWeight(a){var c,d,e,f,b=a.gxlxdms;if("undefined"!=typeof b&&""!=b){for(c=new Array,d=b.split(","),e=0;e<d.length;e++)c.indexOf(d[e])<0&&c.push(d[e]);return f=c.length,1==f?1:f>5?1.8:f/10+1.2}return 1}function getLineColor(a){var b,c,d,e,f,g;if("undefined"==typeof a.type||"hz"!=a.type){if(b=a.gxlxdms,"undefined"!=typeof b&&""!=b){for(c=new Array,d=b.split(","),e=0;e<d.length;e++)c.indexOf(d[e])<0&&c.push(d[e]);switch(f=c.length,g="#999",f){case 1:g="#999";break;case 2:g="#FFB90F";break;case 3:g="#FF7F00";break;case 4:g="#FF6347";break;default:g="#FF0000"}return g}return"#999"}}function getNodeImage(a){var c,b=getContextPath();return"undefined"==typeof a.icon?b+="resource/plugins/txh/img/qt.png":"RY"==a.icon?(c="RY"==a.id.substring(0,2)?a.id.substr(2):a.id,null!=nodes_ry_img[c]?b=nodes_ry_img[c]:(b+="resource/plugins/txh/img/ry.png",setTimeout(function(){getRyImg(c)},200))):b+="CL"==a.icon?"resource/plugins/txh/img/cl.png":"DH"==a.icon?"resource/plugins/txh/img/dh.png":"AJ"==a.icon?"resource/plugins/txh/img/aj.png":"SJ"==a.icon?"resource/plugins/txh/img/sj.png":"DZ"==a.icon?"resource/plugins/txh/img/dz.png":"JG"==a.icon?"resource/plugins/txh/img/jg.png":"RY_HZ"==a.icon?"resource/plugins/txh/img/ry_hz.png":"CL_HZ"==a.icon?"resource/plugins/txh/img/cl_hz.png":"DH_HZ"==a.icon?"resource/plugins/txh/img/dh_hz.png":"AJ_HZ"==a.icon?"resource/plugins/txh/img/aj_hz.png":"SJ_HZ"==a.icon?"resource/plugins/txh/img/sj_hz.png":"DZ_HZ"==a.icon?"resource/plugins/txh/img/dz_hz.png":"JG_HZ"==a.icon?"resource/plugins/txh/img/jg_hz.png":"YS_RY"==a.icon?"resource/plugins/txh/img/ys_ry.png":"YS_AJ"==a.icon?"resource/plugins/txh/img/ys_aj.png":"YS_CL"==a.icon?"resource/plugins/txh/img/ys_cl.png":"YS_DH"==a.icon?"resource/plugins/txh/img/ys_dh.png":"YS_DZ"==a.icon?"resource/plugins/txh/img/ys_dz.png":"YS_HZ"==a.icon?"resource/plugins/txh/img/ys_hz.png":"YS_JG"==a.icon?"resource/plugins/txh/img/ys_jg.png":"YS_SJ"==a.icon?"resource/plugins/txh/img/ys_sj.png":"YS_YS"==a.icon?"resource/plugins/txh/img/ys_ys.png":"YS_YS_HY"==a.icon?"resource/plugins/txh/img/ys_ys_hy.png":"YS_YS_LJ"==a.icon?"resource/plugins/txh/img/ys_ys_lj.png":"YS_YS_MHTDP"==a.icon?"resource/plugins/txh/img/ys_ys_mhtdp.png":"YS_YS_MHTHP"==a.icon?"resource/plugins/txh/img/ys_ys_mhthp.png":"YS_YS_TARY"==a.icon?"resource/plugins/txh/img/ys_ys_tary.png":"YS_YS_TCC"==a.icon?"resource/plugins/txh/img/ys_ys_tcj.png":"YS_YS_TCRJ"==a.icon?"resource/plugins/txh/img/ys_ys_tcrj.png":"YS_YS_TCWZ"==a.icon?"resource/plugins/txh/img/ys_ys_tcwz.png":"YS_YS_TJG"==a.icon?"resource/plugins/txh/img/ys_ys_tjg.png":"YS_YS_TLTCC"==a.icon?"resource/plugins/txh/img/ys_ys_tltcc.png":"YS_YS_TZZ"==a.icon?"resource/plugins/txh/img/ys_ys_tzz.png":"YS_YS_ZTTARY"==a.icon?"resource/plugins/txh/img/ys_ys_zttary.png":"resource/plugins/txh/img/qt.png",b}function getContextPath(){var c,a=document.location.toString(),b="";return-1!=a.indexOf("://")&&(b+=a.substring(0,a.indexOf("//")+2),a=a.substring(a.indexOf("//")+2,a.length)),c=a.indexOf("/"),b+=a.substring(0,c+1),a=a.substring(c+1),c=a.indexOf("/"),b+=a.substring(0,c+1)}function resetGraph(){}function resetGxdata(){var b,c,a=0;if(null!=nodes&&nodes.length>0){for(b=0;b<nodes.length;b++)nodes[b].index=b;a=nodes.length}if(null!=edges&&edges.length>0)for(b=0;b<edges.length;b++)if(null!=nodes&&nodes.length>0)for(c=0;c<nodes.length;c++)edges[b].fromID==nodes[c].id&&(edges[b].source=c),edges[b].toID==nodes[c].id&&(edges[b].target=c);return a}function initGraph(a,b){var c,d,e,f,g,h;for(clearAll(),isIE=$.browser.msie,nodeGraph=b,c=0;c<b.nodes.length;c++)b.nodes[c].index=c;for(c=0;c<b.edges.length;c++)for(d=0;d<b.nodes.length;d++)b.edges[c].fromID==b.nodes[d].id&&(b.edges[c].source=b.nodes[d].index),b.edges[c].toID==b.nodes[d].id&&(b.edges[c].target=b.nodes[d].index);if(force=d3.layout.force().nodes(b.nodes).links(b.edges).size([width,height]).linkDistance(link_d).charge(charge).start(),nodes=force.nodes(),edges=force.links(),node=vis.selectAll("image"),edges_line=vis.selectAll("line").data(b.edges).enter().append("line").attr("class",function(a){return getLineType(a)}).style("stroke",function(a){return getLineColor(a)}).style("stroke-width",function(a){return getLineWeight(a)}),edges_text=vis.selectAll(".linetext").data(b.edges).enter().append("text").attr("class","linetext").style("fill-opacity",1==relation_show?1:0).text(function(a){return a.relation}).on("mousedown",function(a){toDetail(a),event.stopPropagation()}),drag=force.drag().on("dragstart",function(a){a.fixed=!0,node_start_x=a.x,node_start_y=a.y}).on("dragend",function(){}).on("drag",function(){}),null!=a&&""!=a)for(e=a.split(","),f=0;f<e.length;f++)vis.append("path").attr("class","pathRoot").attr("fill","none").attr("stroke","#EE6911").attr("stroke-width","1").attr("lx","initHightLight").attr("id","bs_"+e[f]);nodes_img=vis.selectAll("image").data(b.nodes).enter().append("image").attr("id",function(a){return a.fixed=!1,a.id.substr(2)}).attr("width",img_w).attr("height",img_h).attr("xlink:href",function(a){return getNodeImage(a)}).on("mouseover",function(a){isOverNode=!0,3==relation_show&&edges_text.style("fill-opacity",function(b){return b.source===a||b.target===a?1:void 0})}).on("mouseout",function(a){isOverNode=!1,3==relation_show&&edges_text.style("fill-opacity",function(b){return b.source===a||b.target===a?0:void 0})}).on("mousedown",function(a,b){isChoiceNode=!0,choiceNode=this,choiceNode2=a,choiceNodeIndex=b}).on("dblclick",function(a){a.fixed=!1}).call(drag),g=-20,h=20,nodes_text=vis.selectAll(".nodetext").data(b.nodes).enter().append("text").attr("class","nodetext").attr("dx",g).attr("dy",h).text(function(a){return a.name}),force.on("tick",function(){b.nodes.forEach(function(a){a.x=a.x-img_w/2<0?img_w/2:a.x,a.x=a.x+img_w/2>width?width-img_w/2:a.x,a.y=a.y-img_h/2<0?img_h/2:a.y,a.y=a.y+img_h/2+h>height?height-img_h/2-h:a.y}),edges_line.attr("x1",function(a){return a.source.x}),edges_line.attr("y1",function(a){return a.source.y}),edges_line.each(function(a){var b,c,d,e,f,g;isIE&&this.parentNode.insertBefore(this,this),b=a.source.x,c=a.source.y,x2=a.target.x,y2=a.target.y,d=Math.sqrt(Math.pow(x2-b,2)+Math.pow(y2-c,2)),e=20,f=b+(d-e)/d*(x2-b),g=c+(d-e)/d*(y2-c),d3.select(this).attr("x2",f).attr("y2",g)}),edges_text.attr("x",function(a){return(a.source.x+a.target.x)/2}),edges_text.attr("y",function(a){return(a.source.y+a.target.y)/2}),nodes_img.attr("x",function(a){return a.x-img_w/2}),nodes_img.attr("y",function(a){return a.y-img_h/2}),nodes_text.attr("x",function(a){return a.x}),nodes_text.attr("y",function(a){return a.y+img_w/2}),b.nodes.forEach(function(b){var d,e,f,g,j,k,n;a.indexOf(b.id)>-1&&(d=b.x-img_w/2,e=b.y-img_h/2,f=d,g=e,j=d+img_w,k=e+img_h,n="M"+f+" "+g+" "+"A 20 20 0 1 0 "+j+" "+k+"A 20 20 0 1 0 "+f+" "+g,vis.select("#bs_"+b.id).attr("d",n))})}),center_view()}function expandGraph(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(clearAll(),b=1,c=2*Math.PI*b,d=c/a.nodes.length,e=d/b,f=0,g=0,h=resetGxdata(),i=0;i<a.nodes.length;i++){if(j=!1,null!=choiceNode2&&(0==i?(f=choiceNode2.x+1,g=choiceNode2.y):(k=e-Math.asin((f-choiceNode2.x)/b),f=Math.sin(k)+choiceNode2.x,g=Math.cos(k)+choiceNode2.y),a.nodes[i].x=f,a.nodes[i].y=g,a.nodes[i].px=f,a.nodes[i].py=g),null!=nodes){for(l=0;l<nodes.length;l++)if(a.nodes[i].id==nodes[l].id){j=!0;break}}else nodes=new Array;j||(a.nodes[i].index=h,nodes.push(a.nodes[i]),h++)}for(i=0;i<a.edges.length;i++){if(null!=edges)for(l=0;l<nodes.length;l++)a.edges[i].fromID==nodes[l].id&&(a.edges[i].source=nodes[l].index),a.edges[i].toID==nodes[l].id&&(a.edges[i].target=nodes[l].index);else edges=new Array;if(m=!1,null!=edges)for(l=0;l<edges.length;l++)(a.edges[i].toID==edges[l].toID&&a.edges[i].fromID==edges[l].fromID||a.edges[i].fromID==edges[l].toID&&a.edges[i].toID==edges[l].fromID)&&"undefined"!=typeof edges[l].relation&&edges[l].relation.indexOf(a.edges[i].relation)<0&&(edges[l].relation+=","+a.edges[i].relation,a.edges[i].relation=""),a.edges[i].toID==edges[l].toID&&a.edges[i].fromID==edges[l].fromID&&(m=!0);m||edges.push(a.edges[i])}edges_line=vis.selectAll("line").data(edges).enter().append("line").attr("class",function(a){return getLineType(a)}).style("stroke",function(a){return getLineColor(a)}).style("stroke-width",function(a){return getLineWeight(a)}),edges_text=vis.selectAll(".linetext").data(edges).enter().append("text").attr("class","linetext").style("fill-opacity",1==relation_show?1:0).text(function(a){return a.relation}).on("mousedown",function(a){toDetail(a),event.stopPropagation()}),nodes_img=vis.selectAll("image").data(nodes).enter().append("image").attr("class","imagenode").attr("id",function(a){return a.id.substr(2)}).attr("width",img_w).attr("height",img_h).attr("xlink:href",function(a){return getNodeImage(a)}).on("mouseover",function(a){isOverNode=!0,3==relation_show&&edges_text.style("fill-opacity",function(b){return b.source===a||b.target===a?1:void 0})}).on("mouseout",function(a){isOverNode=!1,3==relation_show&&edges_text.style("fill-opacity",function(b){return b.source===a||b.target===a?0:void 0})}).on("mousedown",function(a,b){isChoiceNode=!0,choiceNode=this,choiceNode2=a,choiceNodeIndex=b}).on("dblclick",function(a){a.fixed=!1}).call(drag),n=-20,o=20,nodes_text=vis.selectAll(".nodetext").data(nodes).enter().append("text").attr("class","nodetext").attr("dx",n).attr("dy",o).text(function(a){return a.name}),force.friction(.5),force.on("start",function(){}),force.on("end",function(){}),force.on("tick",function(){nodes.forEach(function(a){a.x=a.x-img_w/2<0?img_w/2:a.x,a.x=a.x+img_w/2>width?width-img_w/2:a.x,a.y=a.y-img_h/2<0?img_h/2:a.y,a.y=a.y+img_h/2+o>height?height-img_h/2-o:a.y}),edges_line.attr("x1",function(a){return a.source.x}),edges_line.attr("y1",function(a){return a.source.y}),edges_line.each(function(a){var b,c,d,e,f,g;isIE&&null!=this.parentNode&&this.parentNode.insertBefore(this,this),b=a.source.x,c=a.source.y,x2=a.target.x,y2=a.target.y,d=Math.sqrt(Math.pow(x2-b,2)+Math.pow(y2-c,2)),e=20,f=b+(d-e)/d*(x2-b),g=c+(d-e)/d*(y2-c),d3.select(this).attr("x2",f).attr("y2",g)}),edges_text.attr("x",function(a){return(a.source.x+a.target.x)/2}),edges_text.attr("y",function(a){return(a.source.y+a.target.y)/2}),nodes_img.attr("x",function(a){return a.x-img_w/2}),nodes_img.attr("y",function(a){return a.y-img_h/2}),nodes_text.attr("x",function(a){return a.x}),nodes_text.attr("y",function(a){return a.y+img_w/2}),nodes.forEach(function(a,b){var d,e,f,g,h,i,j,k,l,m,n,c=d3.selectAll(".pathRoot")[0];for(b=0;b<c.length;b++)if(a.id==c[b].id.substr(3)){d=a.x-img_w/2,e=a.y-img_h/2,f=d,g=e,h=d+img_w,i=e,j=d+img_w,k=e+img_h,l=d,m=e+img_h,n="M"+f+" "+g+" "+"L"+h+" "+i+" "+"L"+j+" "+k+" "+"L"+l+" "+m+" Z","initHightLight"==d3.select(c[b]).attr("lx")&&(n="M"+f+" "+g+" "+"A 20 20 0 1 0 "+j+" "+k+"A 20 20 0 1 0 "+f+" "+g),d3.select(c[b]).attr("d",n);break}})}),force.stop(),force.start(),delNum=0}function toYct(a,b){var c,d,e,f;"RY"==a?(c=b.replace("RY",""),d="https://10.32.203.192:8444/njws_gxr/gxfx/zhcx.jsp?searchWord="+c+"&programType=1",window.open(d)):"CL"==a?(e=b.replace("CL",""),d="https://10.32.203.192:8444/njws_gxr/gxfx/zhcx.jsp?searchWord="+e+"&programType=26",window.open(d)):"DH"==a&&(f=b.replace("DH",""),d="https://10.32.203.192:8444/njws_gxr/gxfx/zhcx.jsp?searchWord="+f+"&programType=3",window.open(d))}function highLightNode(a){var b,c,d,e,g;if(null!=a&&""!=a){for(b=d3.selectAll(".pathRoot")[0],c=0;c<b.length;c++)"initHightLight"!=d3.select(b[c]).attr("lx")&&d3.select(b[c]).remove();for(d=a.split(","),e=0;e<d.length;e++)vis.append("path").attr("class","pathRoot").attr("fill","none").attr("stroke","red").attr("stroke-width","1").attr("id","bs_"+d[e]);g=20,force.on("tick",function(){nodes.forEach(function(a){a.x=a.x-img_w/2<0?img_w/2:a.x,a.x=a.x+img_w/2>width?width-img_w/2:a.x,a.y=a.y-img_h/2<0?img_h/2:a.y,a.y=a.y+img_h/2+g>height?height-img_h/2-g:a.y}),edges_line.attr("x1",function(a){return a.source.x}),edges_line.attr("y1",function(a){return a.source.y}),edges_line.each(function(a){var b,c,d,e,f,g;isIE&&null!=this.parentNode&&this.parentNode.insertBefore(this,this),b=a.source.x,c=a.source.y,x2=a.target.x,y2=a.target.y,d=Math.sqrt(Math.pow(x2-b,2)+Math.pow(y2-c,2)),e=20,f=b+(d-e)/d*(x2-b),g=c+(d-e)/d*(y2-c),d3.select(this).attr("x2",f).attr("y2",g)}),edges_text.attr("x",function(a){return(a.source.x+a.target.x)/2}),edges_text.attr("y",function(a){return(a.source.y+a.target.y)/2}),nodes_img.attr("x",function(a){return a.x-img_w/2}),nodes_img.attr("y",function(a){return a.y-img_h/2}),nodes_text.attr("x",function(a){return a.x}),nodes_text.attr("y",function(a){return a.y+img_w/2}),nodes.forEach(function(a,b){var d,e,f,g,h,i,j,k,l,m,n,c=d3.selectAll(".pathRoot")[0];for(b=0;b<c.length;b++)if(a.id==c[b].id.substr(3)){d=a.x-img_w/2,e=a.y-img_h/2,f=d,g=e,h=d+img_w,i=e,j=d+img_w,k=e+img_h,l=d,m=e+img_h,n="M"+f+" "+g+" "+"L"+h+" "+i+" "+"L"+j+" "+k+" "+"L"+l+" "+m+" Z","initHightLight"==d3.select(c[b]).attr("lx")&&(n="M"+f+" "+g+" "+"A 20 20 0 1 0 "+j+" "+k+"A 20 20 0 1 0 "+f+" "+g),d3.select(c[b]).attr("d",n);break}})}),force.stop(),force.start()}}var node_start_x,node_start_y,shiftKey,ctrlKey,xScale,yScale,translate,scale,hideRelations,showRelations,isChoiceNode,zoomer,svg,defs,arrowMarker,arrow_path,brusher,svg_graph,rect,brush,vis,data01,nodeGraph=null,choiceNode=null,choiceNode2=null,choiceNodeIndex=null,isOverNode=!1,nodes=null,edges=null,edges_line=null,edges_text=null,nodes_img=null,nodes_text=null,nodes_ry_img=new Object,pathRoot=null,rootName=null,rootId=null,rootLx=null,drag=null,node=null,force=null,label_text_1=null,label_text_2=null,isIE=!1;nodeGraph=null,xScale=d3.scale.linear().domain([0,width]).range([0,width]),yScale=d3.scale.linear().domain([0,height]).range([0,height]),translate=[],scale=0,hideRelations=[],showRelations=[],isChoiceNode=!1,$("body").mouseup(function(){isChoiceNode=!1}),zoomer=d3.behavior.zoom().scaleExtent([.1,10]).on("zoomstart",zoomstart).on("zoom",zoom),svg=d3.select("#mysvg").attr("tabindex",1).on("keydown.brush",keydown).on("keyup.brush",keyup).on("mouseup.brush",mouseup).each(function(){this.focus()}).append("svg").attr("width",width).attr("height",height),svg.append("rect").attr("class","overlay").attr("width",width).attr("height",height),defs=svg.append("defs"),arrowMarker=defs.append("marker").attr("id","arrow").attr("markerUnits","strokeWidth").attr("markerWidth","24").attr("markerHeight","24").attr("viewBox","0 0 24 24").attr("refX","12").attr("refY","6").attr("orient","auto"),arrow_path="M2,2 L10,6 L2,10 L6,6 L2,2",arrowMarker.append("path").attr("d",arrow_path).attr("fill","#000000"),brusher=d3.svg.brush().x(xScale).y(yScale).on("brushstart",function(){}).on("brush",function(){var a,c,d,e;for($("#ttt04").text(Math.random()),a=d3.event.target.extent(),c=vis.selectAll(".nodetext"),c.classed("selected",function(b){return b.selected=b.previouslySelected^((a[0][0]-translate[0])/scale<=b.x&&b.x<(a[1][0]-translate[0])/scale&&(a[0][1]-translate[1])/scale<=b.y&&b.y<(a[1][1]-translate[1])/scale)}),d=svg.selectAll(".nodetext")[0],e=0;e<d.length;e++)1==d[e].__data__.selected&&d3.select(d[e]).style("display","block")}).on("brushend",function(){d3.event.target.clear(),d3.select(this).call(d3.event.target)}),svg_graph=svg.append("svg:g").call(zoomer),rect=svg_graph.append("svg:rect").attr("width",width).attr("height",height).attr("fill","transparent").attr("stroke","transparent").attr("stroke-width",1).attr("id","zrect"),brush=svg_graph.append("g").datum(function(){return{selected:!1,previouslySelected:!1}}).attr("class","brush"),vis=svg_graph.append("svg:g"),vis.attr("id","vis"),brush.call(brusher).on("mousedown.brush",null).on("touchstart.brush",null).on("touchmove.brush",null).on("touchend.brush",null),brush.select(".background").style("cursor","auto"),data01=new Array;